# AGENTS.md

This file helps AI agents work effectively in this repository.

## Project Overview

This is the **official documentation site for TUIOS** (Terminal UI Operating System) built with:
- **Fumadocs** (docs framework) - https://fumadocs.dev
- **TanStack Start** (React framework) - https://tanstack.com/start
- **TanStack Router** (file-based routing)
- **React 19** + **TypeScript**
- **Vite** (build tool)
- **Tailwind CSS v4** (styling)
- **Biome** (linting and formatting)
- **Nitro** (server deployment target)
- **Bun** (package manager - see bun.lock)

The project documents TUIOS, a Go-based terminal window manager located at `../tuios/`.

## Content Source

Documentation is converted from the main TUIOS repository:
- **Source**: `/Users/gaurav/dev/tuios/` (Go project with 85+ files, ~13k LOC)
- **Docs**: `/Users/gaurav/dev/tuios/docs/*.md` (9 comprehensive markdown files)
- **Conversion**: Markdown → MDX with frontmatter and Fumadocs components

## Documentation Structure

```
content/docs/
├── index.mdx              # Homepage - TUIOS overview
├── getting-started.mdx    # Installation and first steps
├── keybindings.mdx        # Complete keyboard shortcuts (279 lines)
├── configuration.mdx      # TOML config and customization (511 lines)
├── tape-scripting.mdx     # Automation DSL reference (729 lines)
├── cli-reference.mdx      # Command-line interface (598 lines)
└── architecture.mdx       # Technical internals (571 lines)
```

## Deployment

**Target**: GitHub Pages at `tuios.gaurav.zip`

**Setup**:
- CNAME file: `public/CNAME` → `tuios.gaurav.zip`
- GitHub Actions: `.github/workflows/deploy.yml`
- Build output: `.output/public/` (static site)

**Workflow**:
1. Push to `main` branch
2. GitHub Actions builds with Bun
3. Uploads to GitHub Pages
4. Deploys to custom domain

## Essential Commands

All commands use npm/pnpm/yarn/bun (bun is used based on bun.lock):

```bash
# Development server (port 3000)
bun run dev

# Build for production
bun run build

# Start production server
bun run start

# Type checking (runs fumadocs-mdx + tsc)
bun run types:check

# Linting
bun run lint

# Formatting
bun run format

# Post-install (generates MDX collections)
bun run postinstall  # runs fumadocs-mdx
```

**Important**: `fumadocs-mdx` must run after install and before type checking. It generates collection files in `.source/` directory.

## Project Structure

```
/
├── content/docs/          # MDX documentation files
│   ├── index.mdx         # Homepage docs
│   └── *.mdx             # Other docs pages
├── src/
│   ├── routes/           # TanStack Router file-based routes
│   │   ├── __root.tsx    # Root layout (HTML shell)
│   │   ├── index.tsx     # Landing page
│   │   ├── docs/$.tsx    # Dynamic docs pages (catch-all)
│   │   └── api/search.ts # Search API endpoint
│   ├── components/       # React components
│   │   └── not-found.tsx # 404 page
│   ├── lib/              # Utilities and configs
│   │   ├── source.ts     # Fumadocs source loader
│   │   └── layout.shared.tsx # Shared layout options
│   ├── styles/
│   │   └── app.css       # Tailwind + Fumadocs CSS imports
│   ├── router.tsx        # Router configuration
│   └── routeTree.gen.ts  # Auto-generated route tree (DO NOT EDIT)
├── .source/              # Auto-generated MDX collections (DO NOT EDIT)
├── .output/              # Build output (gitignored)
├── .tanstack/            # TanStack cache (gitignored)
├── source.config.ts      # Fumadocs MDX config
├── vite.config.ts        # Vite + plugins config
├── tsconfig.json         # TypeScript config
└── biome.json            # Biome config
```

## Generated Files (Do Not Edit Manually)

- `src/routeTree.gen.ts` - Generated by TanStack Router
- `.source/*` - Generated by fumadocs-mdx from MDX content
- `.output/*` - Build output
- `.tanstack/*` - Router cache

## Code Organization

### Routing

Uses **TanStack Router file-based routing**:
- Routes are defined in `src/routes/` directory
- Each file exports a `Route` created with `createFileRoute()`
- Route files must export `Route` constant
- Catch-all route: `docs/$.tsx` handles all `/docs/*` paths
- Route tree is auto-generated in `routeTree.gen.ts`

Example route structure:
```tsx
export const Route = createFileRoute('/path')({
  component: ComponentName,
  loader: async ({ params }) => { /* ... */ },
});
```

### Documentation Content

- All docs content lives in `content/docs/` as MDX files
- MDX frontmatter:
  ```yaml
  ---
  title: Page Title
  description: Page description
  icon: LucideIconName  # Optional, from lucide-static
  ---
  ```
- Fumadocs UI components available in MDX (Cards, Card, etc.)
- Content is loaded via `source` object from `@/lib/source.ts`

### Server Functions

TanStack Start uses **server functions** for data loading:
- Created with `createServerFn({ method: 'GET' })`
- Input validation with `.inputValidator()`
- Handler with `.handler()`
- Example in `docs/$.tsx` loader

### Client-Side Collections

Fumadocs provides browser-side MDX loading:
- Import from `fumadocs-mdx:collections/browser`
- Use `createClientLoader()` for lazy MDX loading
- Preload in route loader for SSR

## Styling Conventions

### Tailwind CSS v4

- CSS imports in `app.css` use `@import 'tailwindcss'`
- Fumadocs preset: `@import 'fumadocs-ui/css/preset.css'`
- Theme: `@import 'fumadocs-ui/css/neutral.css'`
- Plugin configured in vite.config.ts (`@tailwindcss/vite`)

### Class Naming

- Uses Tailwind utility classes
- Fumadocs prefix: `fd-*` (e.g., `fd-primary`, `fd-muted-foreground`)
- Common pattern: `className="text-center py-32 justify-center"`

## TypeScript Configuration

- **Strict mode enabled**
- Module resolution: `Bundler`
- Path aliases:
  - `@/*` → `./src/*`
  - `fumadocs-mdx:collections/*` → `.source/*`
- JSX: `react-jsx` (automatic runtime)
- Target: ES2022
- `noEmit: true` (Vite handles compilation)

## Linting and Formatting

### Biome Configuration

- Formatter: 2 space indentation
- Linter: Recommended rules + React recommended
- Auto-organizes imports
- Respects .gitignore
- Ignores: `node_modules`, `.source`

**Before committing**:
1. Run `bun run lint` to check
2. Run `bun run format` to fix formatting
3. Run `bun run types:check` to verify types

## Key Dependencies

### Core Frameworks
- `@tanstack/react-router` - File-based routing
- `@tanstack/react-start` - SSR/SSG framework
- `fumadocs-core` - Docs framework core
- `fumadocs-ui` - UI components for docs
- `fumadocs-mdx` - MDX processing

### Build Tools
- `vite` - Build tool (port 3000 in dev)
- `nitro` - Server deployment target
- `@vitejs/plugin-react` - React support
- `@tailwindcss/vite` - Tailwind v4 plugin
- `vite-tsconfig-paths` - Path alias support

### Utilities
- `lucide-static` - Icon library (for MDX frontmatter)
- `tailwind-merge` - Tailwind class merging

## Development Workflow

1. **Adding new docs page**:
   - Create MDX file in `content/docs/`
   - Add frontmatter (title, description, icon)
   - Write content using Fumadocs components
   - Server auto-reloads

2. **Adding new route**:
   - Create file in `src/routes/`
   - Export `Route` with `createFileRoute()`
   - Route tree regenerates automatically

3. **Modifying components**:
   - Edit files in `src/components/` or `src/lib/`
   - Hot reload handles updates
   - Run type check before committing

4. **Testing changes**:
   - Dev server: `bun run dev`
   - Type check: `bun run types:check`
   - Lint: `bun run lint`
   - Build: `bun run build`

## Search Functionality

- API endpoint: `/api/search` (defined in `src/routes/api/search.ts`)
- Uses Fumadocs search server (`createFromSource`)
- Language: English (configurable via Orama)
- Searches across all docs content

## Icon System

- Uses `lucide-static` package
- Icons referenced by name in MDX frontmatter
- Loaded in `source.ts` icon() function
- Converted to SVG strings, rendered with `dangerouslySetInnerHTML`

## Layout Structure

### Root Layout (`__root.tsx`)
- HTML document shell
- Head configuration (meta, viewport, title, stylesheet)
- Uses `RootProvider` from fumadocs-ui
- Renders `<Outlet />` for child routes

### Shared Layout Options (`layout.shared.tsx`)
- Exported `baseOptions()` function
- Returns `BaseLayoutProps` for Fumadocs layouts
- Navigation title: "Tanstack Start"
- Used by both `HomeLayout` and `DocsLayout`

### Page Layouts
- Home: `HomeLayout` with centered content
- Docs: `DocsLayout` with sidebar navigation
- 404: `HomeLayout` with error message

## Important Patterns

### Page Tree Transformation
The docs route (`docs/$.tsx`) includes a `transformPageTree()` function that:
- Converts string icons to JSX elements
- Recursively processes folder children
- Handles folder index pages
- Required because icons from server are strings

### MDX Components
- Default components from `fumadocs-ui/mdx`
- Can extend with custom components in `DocsPage`
- Available components: `Card`, `Cards`, code blocks, tables, etc.

### Server/Client Split
- Server functions fetch page metadata and tree structure
- Client loader handles MDX lazy loading
- Preloading in loader enables SSR
- Separation improves bundle size

## Gotchas and Important Notes

1. **Route tree regeneration**: `routeTree.gen.ts` auto-updates. Don't edit it.

2. **MDX collections**: Run `fumadocs-mdx` after adding/modifying docs. Handled by postinstall script.

3. **Port configuration**: Dev server runs on port 3000 (configured in vite.config.ts).

4. **Type imports**: Use `import type` for type-only imports (TypeScript best practice).

5. **Path aliases**: Use `@/` prefix for src imports, not relative paths.

6. **Catch-all routes**: `$.tsx` filename creates catch-all route. Access via `params._splat`.

7. **Search API**: Separate server route, not a React component. Uses TanStack Start server handlers.

8. **Prerendering**: Enabled in TanStack Start config (`vite.config.ts`). Static pages generated at build time.

9. **Nitro deployment**: Configured for hosting. See TanStack Start hosting docs for other targets.

10. **CSS imports**: Must use `?url` suffix for CSS in TypeScript (`appCss from '@/styles/app.css?url'`).

11. **React 19**: Uses latest React with automatic JSX runtime. No need for `import React`.

12. **Hydration**: `suppressHydrationWarning` on `<html>` tag prevents hydration warnings from theme switching.

## When Making Changes

**Always**:
- Read relevant files before editing
- Match existing code style (2 space indentation)
- Use TypeScript types (no `any`)
- Import types with `import type`
- Use path aliases (`@/` not relative paths)
- Run type check and lint before committing

**Never**:
- Edit generated files (routeTree.gen.ts, .source/*)
- Commit without type checking
- Add dependencies without updating this file
- Use relative imports when path alias exists
- Commit unformatted code (run `bun run format`)

## Additional Resources

- [Fumadocs Documentation](https://fumadocs.dev)
- [TanStack Start Documentation](https://tanstack.com/start)
- [TanStack Router Documentation](https://tanstack.com/router)
- [Tailwind CSS v4 Documentation](https://tailwindcss.com/docs)
- [Biome Documentation](https://biomejs.dev)
